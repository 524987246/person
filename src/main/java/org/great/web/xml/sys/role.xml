<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="org.great.web.mapper.sys.RoleMapper">
	<!--基础属性 -->
	<sql id="beanAttr">
		a.id,
		a.name,
		a.create_by AS "createBy.id",
		DATE_FORMAT(a.create_date,'%Y-%m-%d') AS "createDate",
		a.update_by AS
		"updateBy.id",
		DATE_FORMAT(a.update_date,'%Y-%m-%d') AS "updateDate",
		a.remarks,
		a.isemploy
	</sql>
	<!--主表名 -->
	<sql id="tableName">
		sys_role
	</sql>
	<!--主表名 基本更新信息 -->
	<sql id="baseUpdateInfo">
		<if test="createBy !=null and createBy.id !=null and createBy.id!=''">
			a.create_by=#{createBy.id},
		</if>
		<if test="createDate !=null and createDate !=''">
			a.create_date=#{createDate},
		</if>
		<if test="updateBy !=null and updateBy.id !=null and updateBy.id!=''">
			a.update_by=#{updateBy.id},
		</if>
		<if test="updateDate !=null and updateDate !=''">
			a.update_date=#{updateDate},
		</if>
		<if test="remarks !=null and remarks !=''">
			a.remarks=#{remarks},
		</if>
	</sql>
	<!--查询条件信息 -->
	<sql id="whereInfo">
		<where>
			a.isemploy=1
			<if test="queryBeginDate != null and queryBeginDate != ''">
				AND a.create_date &gt;= #{queryBeginDate}
			</if>
			<if test="queryEndDate != null and queryEndDate != ''">
				AND a.create_date &lt;= #{queryEndDate}
			</if>
		</where>
	</sql>
	<!--手动装配结果 -->
	<resultMap id="roleResult" type="org.great.web.bean.sys.Role">
		<!-- 基本属性 -->
		<id property="id" column="id" />
		<result property="name" column="name" />
		<result property="createBy.id" column="createBy.id" />
		<result property="createDate" column="createDate" />
		<result property="updateBy.id" column="updateBy.id" />
		<result property="updateDate" column="updateDate" />
		<result property="remarks" column="remarks" />
		<result property="isemploy" column="isemploy" />
		<!--菜单集合 -->
		<collection property="menulist" ofType="org.great.web.bean.sys.Menu">
			<id property="id" column="menu.id" />
			<result property="name" column="menu.name" />
			<result property="url" column="menu.url" />
			<result property="parentId" column="menu.parentId" />
			<result property="perms" column="menu.perms" />
			<result property="type" column="menu.type" />
			<result property="icon" column="menu.icon" />
			<result property="orderNum" column="menu.orderNum" />
			<result property="createBy.id" column="menu.createBy.id" />
			<result property="createDate" column="menu.createDate" />
			<result property="updateBy.id" column="menu.updateBy.id" />
			<result property="updateDate" column="menu.updateDate" />
			<result property="remarks" column="menu.remarks" />
			<result property="isemploy" column="menu.isemploy" />
		</collection>
	</resultMap>
	<!-- 查询单个 -->
	<select id="get" parameterType="Long" resultMap="roleResult">
		SELECT
		<include refid="beanAttr" />
		,
		c.id AS "menu.id",
		c.name AS "menu.name",
		c.url AS "menu.url",
		c.parent_id AS "menu.parentId",
		c.perms AS "menu.perms",
		c.type AS
		"menu.type",
		c.icon AS "menu.icon",
		c.order_num AS "menu.orderNum",
		c.create_by AS "menu.createBy.id",
		DATE_FORMAT(c.create_date,'%Y-%m-%d') AS "menu.createDate",
		c.update_by AS"menu.updateBy.id",
		DATE_FORMAT(c.update_date,'%Y-%m-%d') AS "menu.updateDate",
		c.remarks
		AS "menu.remarks",
		c.isemploy AS "menu.isemploy"
		FROM
		<include refid="tableName" />
		a
		left join
		sys_role_menu b
		on b.role_id=a.id and b.isemploy=1
		left join sys_menu c
		on c.id=b.menu_id and c.isemploy=1
		where a.id=#{id}
	</select>

	<!-- 查询集合 -->
	<select id="findList" resultType="org.great.web.bean.sys.Role"
		parameterType="org.great.web.bean.sys.Role">
		SELECT
		<include refid="beanAttr" />
		FROM
		<include refid="tableName" />
		a
		<include refid="whereInfo" />
		ORDER BY a.create_date DESC
	</select>
	<!-- 查询总数 -->
	<select id="queryTotal" resultType="Integer" parameterType="org.great.web.bean.sys.Role">
		SELECT
		count(*)
		FROM
		<include refid="tableName" />
		a
		<include refid="whereInfo" />
	</select>
	<!-- 删除 -->
	<select id="delete" parameterType="org.great.web.bean.sys.Role">
		UPDATE
		<include refid="tableName" />
		SET
		isemploy=#{isemploy}
		WHERE
		id=#{id}
	</select>
	<!-- 批量删除 -->
	<select id="batchdelete">
		UPDATE
		<include refid="tableName" />
		SET
		isemploy=#{isemploy}
		WHERE
		id in
		<foreach item="id" collection="list" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</select>
	<!-- 更新 -->
	<select id="update" parameterType="org.great.web.bean.sys.Role">
		UPDATE
		<include refid="tableName" />
		<set>
			<include refid="baseUpdateInfo" />
			<if test="name !=null and name !=''">name=#{name},</if>
		</set>
		WHERE
		sid=#{sid}
	</select>
	<!-- 保存 -->
	<select id="save" parameterType="org.great.web.bean.sys.Role">
		INSERT INTO
		<include refid="tableName" />
		(create_by,create_date,update_by,update_date
		<if test="remarks !=null and remarks !=''">,remarks</if>
		<if test="name !=null and name !=''">,name</if>
		)VALUES(#{createBy.id},#{createDate},#{updateBy.id},#{updateDate}
		<if test="remarks !=null and remarks !=''">,#{remarks}</if>
		<if test="name !=null and name !=''">,#{name}</if>
		)
	</select>
</mapper>